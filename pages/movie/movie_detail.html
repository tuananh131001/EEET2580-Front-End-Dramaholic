<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"
      integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
    href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:wght@100&display=swap"
    rel="stylesheet"
  />
    <link
      rel="stylesheet"
      type="text/css"
      href="../../css/styles_movieDetail.css"
    />
    <script
      src="https://kit.fontawesome.com/a59b9b09ab.js"
      crossorigin="anonymous"
    ></script>
    <title>Movie Detail</title>
  </head>

  <body>
    <div id="blur_frame" class="blur">
      <!-- title -->
      <div id="movie_title" class="title"></div>

      <div id="movie_rating" class="regular_setting rating">
        <div id="movie_radio">
          <input type="radio" id="star0" /><label for="star0"></label>
          <input type="radio" id="star1" /><label for="star1"></label>
          <input type="radio" id="star2" /><label for="star2"></label>
          <input type="radio" id="star3" /><label for="star3"></label>
          <input type="radio" id="star4" /><label for="star4"></label>
          <input type="radio" id="star5" /><label for="star5"></label>
          <input type="radio" id="star6" /><label for="star6"></label>
          <input type="radio" id="star7" /><label for="star7"></label>
          <input type="radio" id="star8" /><label for="star8"></label>
          <input type="radio" id="star9" /><label for="star9"></label>
        </div>
        <div id="movie_star" class="star"></div>
        <div id="movie_info" class="info"></div>
      </div>
      <div id="movie_description" class="regular_setting description"></div>
      <div class="regular_setting button_container">
        <button class="button btn1" onclick="play_movie()">PLAY MOVIE</button>
        <button class="button btn2" onclick="add_watch_later()">
          WATCH LATER
        </button>
      </div>
      <div id="movie_crew" class="equipe regular_setting">
        <div id="movie_actor" class="cast">
          <div class="icon_container">
            <div>
              <button id="iconl" class="icon" onclick="scrolll()">
                <i class="fas fa-angle-double-left"></i>
              </button>
            </div>
            <p>CAST</p>
            <div>
              <button id="iconr" class="icon" onclick="scrollr()">
                <i class="fas fa-angle-double-right"></i>
              </button>
            </div>
          </div>
          <div class="cover">
            <div class="scroll-images"></div>
          </div>
        </div>

        <!-- director -->
        <div id="movie_director" class="director">
          DIRECTOR BY
          <br />
          <br />
        </div>
      </div>
    </div>
    <div id="youtube_frame" class="youtube_div">
      <!-- <iframe class="youtube" src="https://www.youtube.com/embed/" title="YouTube video player"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen></iframe>; -->
    </div>
    <div class="screen" onclick="stop_movie()">
      <div
        class="split a"

      ></div>
    </div>

    <script src="https://unpkg.com/split.js/dist/split.min.js"></script>


    <script>
      let originalURL = "https://dramaholic.herokuapp.com/api/movies/";

      let id = JSON.parse(localStorage.getItem("dbid"));
      let film_title = "";
      let film_youtube = "";
      var fetchingURL = originalURL + id;

      fetch(fetchingURL)
        .then((response) => response.json())
        .then((json) => {
          console.log(json);
          //parse year
          let text = json.date;
          const json_year = text.split("-");
          let year = json_year[0];
          //
          film_title = json.title;
          let href_cut = json.href.split("https://www.youtube.com/watch?v=");
          film_youtube =
            "https://www.youtube.com/embed/" + href_cut[1] + "?enablejsapi=1";
          console.log(film_youtube);
          document.querySelector(".screen").style.background =
            "url(" +
            json.thumbnail_landscape +
            ") center top / cover no-repeat fixed";
          document.querySelector("#movie_title").innerHTML = json.title;
          document.querySelector("#movie_star").innerHTML = `${json.rating}/10`;
          for (let i = 0; i < json.genres.length; i++) {
            if (i == 0) {
              document.querySelector(
                "#movie_info"
              ).innerHTML += `${json.genres[i]}`;
            } else {
              document.querySelector(
                "#movie_info"
              ).innerHTML += ` & ${json.genres[i]}`;
            }
          }
          document.querySelector("#movie_description").innerHTML =
            json.description;
          // document.querySelector(`#star${5}`).outerHTML = `<input type="radio" id="star${5}" checked><label for="star${5}"></label>`;
          document.querySelector(
            `#star${parseInt(json.rating)}`
          ).outerHTML = `<input type="radio" id="star${parseInt(
            json.rating
          )}" checked>`;
          // document.querySelector(".screen").style.background = `url('${json.thumbnail}')`;
          for (let i = 0; i < json.actors.length; i++) {
            document.querySelector(
              ".scroll-images"
            ).innerHTML += `<div class="child">

                            <img class="child-img" src="${json.actors[i].image}" alt="image">
                            <div class="cast_name">${json.actors[i].name}</div>
                        </div>`;
          }
          for (let i = 0; i < json.director.length; i++) {
            document.querySelector(
              "#movie_director"
            ).innerHTML += `<div class="director_name">${json.director[i]}</div>`;
          }

          //nation name
          const regionNames = new Intl.DisplayNames(["en"], {
            type: "language",
          });
          let country = regionNames.of(json.country.toUpperCase());
          document.querySelector(
            "#movie_info"
          ).innerHTML += ` . ${year} . ${country}`;

          document.querySelector(
            "#youtube_frame"
          ).innerHTML = `<iframe id = "iframe_frame" class="youtube" src="${film_youtube}" title="YouTube video player"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen></iframe>`;

          // document.querySelector("#scroll-images").innerHTML += `
          //         <div class="child">
          //             <img class="child-img" src="../../assets/image_detail/josh.jpg" alt="image">
          //             <div class="cast_name">John Frunsciante</div>
          //         </div>`;
        });

      function play_movie() {
        document.getElementById("youtube_frame").style.visibility = "visible";
      }
      function stop_movie() {
        if (
          document.getElementById("youtube_frame").style.visibility == "visible"
        ) {
          var frame = document.getElementById("iframe_frame");
          frame.contentWindow.postMessage(
            '{"event":"command","func":"pauseVideo","args":""}',
            "*"
          );
          document.getElementById("youtube_frame").style.visibility =
            "collapse";
        }
      }
    </script>

    <!-- Script for watch later -->
    <script>
      function add_watch_later() {
        let originalURL = "https://dramaholic.herokuapp.com/api/customers/";
        let userID = JSON.parse(localStorage.getItem("UserID"));
        let movieID = JSON.parse(localStorage.getItem("dbid"));
        var fetchingURL = originalURL + userID;

            if (userID == null){
                alert("Please sign in or sign up to add movie to watch later")
            }
            else {
                fetch(fetchingURL)
                .then(response => response.json())
                .then(json => {
                    const dataToSend = JSON.stringify({
                        username: json.username,
                        password: json.password,
                        dbID: movieID,
                    });
                    fetch("https://dramaholic.herokuapp.com/api/customers/watchlater", {
                        method: "post",
                        headers: { "Content-Type": "application/json" },
                        body: dataToSend,
                    }).then((response) => {
                        console.log(response);
                    });
                })
            }
        };

    </script>

    <!-- script for youtube frame  -->
    <script>
      var tag = document.createElement("script");
      tag.scr = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName("script")[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
      var player;
      function onYoutubeIframeAPIReady() {
        player = new YT.Player("player", {
          events: {
            onReady: onPlayerReady,
            onStateReady: onPlayerStateChange,
          },
        });
      }
      function scrolll() {
        var left = document.querySelector(".scroll-images");
        left.scrollBy(-85, 0);
      }

      function scrollr() {
        var right = document.querySelector(".scroll-images");
        right.scrollBy(85, 0);
      }
      function onPlayerReady(e) {
        e.target.playVideo();
      }
      function onPlayerStateChange(e) {
        console.log("player state changed");
      }
    </script>
    <!-- Responsive star and rating -->
    <script>


        const responsive_rating = document.querySelector('.star');
        const responsive_star = document.querySelector('#movie_radio');
        function responsiveRating() {
            if (window.outerWidth <= 375) {
                responsive_star.style.visibility = "collapse";
                responsive_rating.style.marginLeft = "0";
                responsive_star.style.width = "0";
            }
            else if (window.outerWidth < 780) {
                responsive_star.style.visibility = "collapse";
                responsive_rating.style.marginLeft = "0";
                responsive_star.style.width = "0";
            }
            else if (window.outerWidth >= 780) {
                responsive_star.style.visibility = "visible";
                responsive_rating.style.marginLeft = "2%";
                responsive_star.style.width = "130px";
            }

        }
      }
      window.onresize = responsiveRating;
    </script>
  </body>
</html>
